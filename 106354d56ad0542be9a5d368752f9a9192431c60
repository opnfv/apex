{
  "comments": [
    {
      "key": {
        "uuid": "5ac10518_ee31320c",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 111,
      "author": {
        "id": 334
      },
      "writtenOn": "2016-11-30T14:44:04Z",
      "side": 1,
      "message": "most other things are variables in this file.  Maybe make .cache a variable, like CACHE_HISTORY or something.",
      "range": {
        "startLine": 111,
        "startChar": 28,
        "endLine": 111,
        "endChar": 34
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_8910a84f",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 111,
      "author": {
        "id": 235
      },
      "writtenOn": "2016-11-30T15:14:10Z",
      "side": 1,
      "message": "Why? it\u0027s not a variable value\nIs there a case that it would be variable?",
      "parentUuid": "5ac10518_ee31320c",
      "range": {
        "startLine": 111,
        "startChar": 28,
        "endLine": 111,
        "endChar": 34
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_a97c8473",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 111,
      "author": {
        "id": 334
      },
      "writtenOn": "2016-11-30T16:37:12Z",
      "side": 1,
      "message": "Well by that logic, then CACHE_DIR shouldn\u0027t be a variable.  I think making it a variable at least helps me understand what .cache actually is.  I didn\u0027t know what it was at first and had to read the code to figure out it was a file, and that names of cached files were being stored in it.  By using a variable with a clear name like CACHE_HISTORY or maybe even renaming the file itself, I think it adds clarity.  Speaking of renaming, it would probably make more sense to make the directory \u0027.cache\u0027 and add to git ignore, and change the history file to be .cache_history or something inside of \u0027.cache\u0027 folder.  A make clean should remove the .cache directory.",
      "parentUuid": "5ac10518_8910a84f",
      "range": {
        "startLine": 111,
        "startChar": 28,
        "endLine": 111,
        "endChar": 34
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_09d6f84f",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 111,
      "author": {
        "id": 235
      },
      "writtenOn": "2016-11-30T16:49:25Z",
      "side": 1,
      "message": "If that\u0027s the naming convention you want that\u0027s fine with me.\nI\u0027ll push another patch.\n\n\nI disagree that make clean should remove the cache dir. Make clean should clean the build, not the cache. I regularly make clean and expect that the cache will still be there so that I don\u0027t have to download the images again.",
      "parentUuid": "5ac10518_a97c8473",
      "range": {
        "startLine": 111,
        "startChar": 28,
        "endLine": 111,
        "endChar": 34
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_2e589a55",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 118,
      "author": {
        "id": 334
      },
      "writtenOn": "2016-11-30T14:44:04Z",
      "side": 1,
      "message": "why not just include the .cache file in the tarball when you build a new cache?",
      "range": {
        "startLine": 111,
        "startChar": 0,
        "endLine": 118,
        "endChar": 16
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_291df466",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 118,
      "author": {
        "id": 235
      },
      "writtenOn": "2016-11-30T15:14:10Z",
      "side": 1,
      "message": "It is, this is rebuilding the new one from the old one to only include files that will be cached in the new cache",
      "parentUuid": "5ac10518_2e589a55",
      "range": {
        "startLine": 111,
        "startChar": 0,
        "endLine": 118,
        "endChar": 16
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_09efd81f",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 118,
      "author": {
        "id": 334
      },
      "writtenOn": "2016-11-30T16:37:12Z",
      "side": 1,
      "message": "Oh ok I see it is validating the file from the cache log exists before copying it as a file destined for the new cache.",
      "parentUuid": "5ac10518_291df466",
      "range": {
        "startLine": 111,
        "startChar": 0,
        "endLine": 118,
        "endChar": 16
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_4e55e61b",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 181,
      "author": {
        "id": 334
      },
      "writtenOn": "2016-11-30T14:44:04Z",
      "side": 1,
      "message": "why are files pushed into build/cache/cache, instead of just build/cache?",
      "range": {
        "startLine": 181,
        "startChar": 4,
        "endLine": 181,
        "endChar": 48
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_491ac06f",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 181,
      "author": {
        "id": 235
      },
      "writtenOn": "2016-11-30T15:14:10Z",
      "side": 1,
      "message": "This patch shifts the caching from being extracted to build/cache it\u0027s extracted directly in build.\n\nThe cache is extracted to the build root so that files cached in place end up in the build root. the second cache dir is for files that are expected to land in build/cache when it is extracted.\n\nThis enables us to cache files we build so that we don\u0027t have to rebuild them if they\u0027ve already been built. Specifically RPMS.",
      "parentUuid": "5ac10518_4e55e61b",
      "range": {
        "startLine": 181,
        "startChar": 4,
        "endLine": 181,
        "endChar": 48
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_c9f8f0e7",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 181,
      "author": {
        "id": 334
      },
      "writtenOn": "2016-11-30T16:37:12Z",
      "side": 1,
      "message": "I think this is too confusing.  For example if I only build.sh once, I end up with apex/cache/cache to find where my real cache was built.  The next time I build, it will have to unpack the tarball to apex/cache, even though apex/cache/cache already has the cache.  This is a wasted operation.  Perhaps after building the new cache in apex/cache/cache it should be moved to apex/cache  and rm -rf apex/cache/cache.  Then on a subsequent build, if apex/cache already exists do not unpack the cache tar.",
      "parentUuid": "5ac10518_491ac06f",
      "range": {
        "startLine": 181,
        "startChar": 4,
        "endLine": 181,
        "endChar": 48
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_c9cf90af",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 181,
      "author": {
        "id": 235
      },
      "writtenOn": "2016-11-30T16:49:25Z",
      "side": 1,
      "message": "This system is only intended to be used by CI. It\u0027s intended that the build tree will be deleted between builds as we do in jenkins.\n\nA dev should use the make files to build and shouldn\u0027t need to worry about this.",
      "parentUuid": "5ac10518_c9f8f0e7",
      "range": {
        "startLine": 181,
        "startChar": 4,
        "endLine": 181,
        "endChar": 48
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_c946b023",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 181,
      "author": {
        "id": 334
      },
      "writtenOn": "2016-11-30T17:00:35Z",
      "side": 1,
      "message": "If that is the case then we should delete this script from our repo and put it in releng build.sh.",
      "parentUuid": "5ac10518_c9cf90af",
      "range": {
        "startLine": 181,
        "startChar": 4,
        "endLine": 181,
        "endChar": 48
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_4e03a60f",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 183,
      "author": {
        "id": 334
      },
      "writtenOn": "2016-11-30T14:52:38Z",
      "side": 1,
      "message": "this assumes a .cache file exists.  When I just ran in my repo:\n[root@nfvsdn-05 ci]# ./build.sh -r blah -c /root/blah --build-cache\nBuilding Cache\nThere are unfinished transactions remaining. You might consider running yum-complete-transaction, or \"yum-complete-transaction --cleanup-only\" and \"yum history redo last\", first to finish them. If those don\u0027t work you\u0027ll have to try removing/installing packages by hand (maybe package-cleanup can help).\nCreating Build Cache Directory\nBuild Complete\nBuilding Cache\ntotal 0\ncat: /root/apex/build/cache/.cache: No such file or directory\nCache Build Complete\nComplete",
      "range": {
        "startLine": 183,
        "startChar": 4,
        "endLine": 183,
        "endChar": 48
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac10518_293414dd",
        "filename": "ci/build.sh",
        "patchSetId": 23
      },
      "lineNbr": 183,
      "author": {
        "id": 235
      },
      "writtenOn": "2016-11-30T15:14:10Z",
      "side": 1,
      "message": "It\u0027s because there was nothing to cache. --build-cache assumes you would have build via make already and wanted to build the cache from the build.\n\nThe error is harmless, the for loop just gets an empty result. Though, I don\u0027t mind adding a conditional to skip this if the file doesn\u0027t exist.",
      "parentUuid": "5ac10518_4e03a60f",
      "range": {
        "startLine": 183,
        "startChar": 4,
        "endLine": 183,
        "endChar": 48
      },
      "revId": "106354d56ad0542be9a5d368752f9a9192431c60",
      "serverId": "bbac25d2-bf60-4904-9ba8-a72fc000d6c5",
      "unresolved": false
    }
  ]
}